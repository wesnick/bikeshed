<div class="container mt-3">
  <h2 class="h4 mb-2">Launch Dialog from Template: {{ template.name }}</h2>
  {% if template.description %}<p class="text-muted mb-3">{{ template.description }}</p>{% endif %}

  {% with dialog_template=template %}
    {% include 'workflow.html.j2' %} {# This will be converted separately #}
  {% endwith %}

  {% if workflow_analysis %}
    <div class="my-4">
      <div class="row">
        {% if workflow_analysis.missing_inputs %}
          <div class="col-md-6">
            <h3 class="h5 mb-3">Required Inputs</h3>
            <div>
              <p>The following inputs may be required during workflow execution:</p>
              <ul class="list-unstyled">
                {% for step_id, inputs in workflow_analysis.missing_inputs.items() %}
                  <li>
                    <strong>{{ step_id }}</strong>:
                    <ul class="list-unstyled ps-3">
                      {% for input_name, input_info in inputs.items() %}<li>{{ input_name }} - {{ input_info.description }}</li>{% endfor %}
                    </ul>
                  </li>
                {% endfor %}
              </ul>
              <p class="fst-italic small">These inputs are optional. If not provided now, the workflow will pause when needed.</p>
            </div>
          </div>
        {% endif %}
        {% if workflow_analysis.provided_outputs %}
          <div class="col-md-6">
            <h3 class="h5 mb-3">Provided Outputs</h3>
            <div>
              <p>The following outputs will be generated during workflow execution:</p>
              <ul class="list-unstyled">
                {% for step_id, outputs in workflow_analysis.provided_outputs.items() %}
                  <li>
                    <strong>{{ step_id }}</strong>:
                    <ul class="list-unstyled ps-3">
                      {% for output_name, output_info in outputs.items() %}
                        <li>{{ output_name }} - {{ output_info.description }}</li>
                      {% endfor %}
                    </ul>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <form hx-post="/dialog/template-creator/{{ template_name }}/create"
        hx-target=".dashboard"
        hx-ext="form-json"
        class="mt-4">
    <div class="mb-3">
      <label class="form-label" for="template-description">Description (optional)</label>
      <input class="form-control form-control-sm"
             type="text"
             id="template-description"
             name="description"
             placeholder="Custom description for this dialog">
      <div class="form-text">Override the default description</div>
    </div>
    <div class="mb-3">
      <label class="form-label" for="template-goal">Goal (optional)</label>
      <textarea class="form-control form-control-sm"
                id="template-goal"
                name="goal"
                rows="3"
                placeholder="Custom goal for this dialog"></textarea>
      <div class="form-text">Override the default goal</div>
    </div>

    {% if workflow_analysis and workflow_analysis.missing_inputs %}
      <div class="my-4">
        <h3 class="h5 mb-2">Optional Input Values</h3>
        <p class="form-text mb-3">
          Provide values for any inputs you want to pre-fill. Leave empty to be prompted during execution.
        </p>
        {% for step_id, inputs in workflow_analysis.missing_inputs.items() %}
          <div class="card mb-3">
            <div class="card-body">
              <h4 class="h6 card-title mb-3">Step: {{ step_id }}</h4>
              {% for input_name, input_info in inputs.items() %}
                <div class="mb-3">
                  <label class="form-label" for="input-{{ step_id }}-{{ input_name }}">{{ input_name }}</label>
                  <input class="form-control form-control-sm"
                         type="text"
                         id="input-{{ step_id }}-{{ input_name }}"
                         name="input[{{ input_name }}]"
                         placeholder="{{ input_info.description }}">
                  <div class="form-text">{{ input_info.description }}</div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="d-flex gap-2 mt-4">
      <button class="btn btn-primary" type="submit">Create Dialog</button>
      <button class="btn btn-secondary"
              hx-get="/components/left-sidebar"
              hx-target="#left-sidebar"
              type="button">Cancel</button>
    </div>
  </form>
</div>
