{# Form for creating or editing a tag #}
{% set is_edit = tag is not none %}
<h2 class="h5 mb-3">{{ "Edit Tag" if is_edit else "Create New Tag" }}</h2>
{% if parent_tag %}
  <p class="small">
    Creating under: <strong>{{ parent_tag.name }}</strong> (<code>{{ parent_tag.path }}</code>)
  </p>
{% elif not is_edit %}
  <p class="small">Creating a top-level tag.</p>
{% endif %}
<form hx-post="{{ '/tags/' + tag.id if is_edit else '/tags' }}" {# Adjust target for PUT later #}
  hx-target="#tag-details" {# Or maybe trigger tree refresh #}
  hx-swap="innerHTML" {# Swap content of the details box on success/error #}
  hx-ext="form-json"
  class="mt-3">
  {# Hidden field for parent path when creating a child #}
  {% if not is_edit and parent_tag %}<input type="hidden" name="parent_path" value="{{ parent_tag.path }}">{% endif %}
  <div class="mb-3">
    <label class="form-label" for="tag-name">Name</label>
    <input class="form-control form-control-sm"
           type="text"
           id="tag-name"
           name="name"
           value="{{ tag.name if is_edit else '' }}"
           required>
    <div class="form-text">User-friendly display name for the tag.</div>
  </div>
  <div class="mb-3">
    <label class="form-label" for="tag-id">ID (Path Segment)</label>
    <input class="form-control form-control-sm"
           type="text"
           id="tag-id"
           name="tag_id"
           value="{{ tag.id if is_edit else '' }}"
           {{ "readonly" if is_edit else "required" }}
           pattern="^[a-z0-9_]+$"
           title="Lowercase letters, numbers, and underscores only.">
    <div class="form-text">Unique identifier used in the tag's path (e.g., 'my_tag'). Cannot be changed after creation.</div>
  </div>
  <div class="mb-3">
    <label class="form-label" for="tag-description">Description</label>
    <textarea class="form-control form-control-sm" id="tag-description" name="description" rows="3">{{ tag.description if is_edit and tag.description else '' }}</textarea>
    <div class="form-text">Optional description for the tag.</div>
  </div>
  <div class="d-flex gap-2 mt-4">
    <button class="btn btn-primary" type="submit">{{ "Save Changes" if is_edit else "Create Tag" }}</button>
    {# Button to cancel and maybe reload the initial state of the details pane #}
    <button class="btn btn-secondary" type="button"
      hx-get="/tags" {# Reloads the main management view, clearing the form #}
      hx-target=".dashboard"
      hx-push-url="true">Cancel</button>
  </div>
</form>
